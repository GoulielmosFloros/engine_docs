"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[8553],{3905:(e,t,n)=>{n.d(t,{Zo:()=>p,kt:()=>f});var o=n(7294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,o,r=function(e,t){if(null==e)return{};var n,o,r={},a=Object.keys(e);for(o=0;o<a.length;o++)n=a[o],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(o=0;o<a.length;o++)n=a[o],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var s=o.createContext({}),c=function(e){var t=o.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},p=function(e){var t=c(e.components);return o.createElement(s.Provider,{value:t},e.children)},m="mdxType",u={inlineCode:"code",wrapper:function(e){var t=e.children;return o.createElement(o.Fragment,{},t)}},d=o.forwardRef((function(e,t){var n=e.components,r=e.mdxType,a=e.originalType,s=e.parentName,p=l(e,["components","mdxType","originalType","parentName"]),m=c(n),d=r,f=m["".concat(s,".").concat(d)]||m[d]||u[d]||a;return n?o.createElement(f,i(i({ref:t},p),{},{components:n})):o.createElement(f,i({ref:t},p))}));function f(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var a=n.length,i=new Array(a);i[0]=d;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l[m]="string"==typeof e?e:r,i[1]=l;for(var c=2;c<a;c++)i[c]=n[c];return o.createElement.apply(null,i)}return o.createElement.apply(null,n)}d.displayName="MDXCreateElement"},7673:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>p,contentTitle:()=>s,default:()=>f,frontMatter:()=>l,metadata:()=>c,toc:()=>m});var o=n(7462),r=n(3366),a=(n(7294),n(3905)),i=["components"],l={},s=void 0,c={unversionedId:"Tutorials/Components/Core/IfcLoader",id:"Tutorials/Components/Core/IfcLoader",title:"IfcLoader",description:"Copying and pasting? We've got you covered! You can find the full source code of this tutorial here.",source:"@site/docs/Tutorials/Components/Core/IfcLoader.mdx",sourceDirName:"Tutorials/Components/Core",slug:"/Tutorials/Components/Core/IfcLoader",permalink:"/Tutorials/Components/Core/IfcLoader",draft:!1,tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"IfcGeometryTiler",permalink:"/Tutorials/Components/Core/IfcGeometryTiler"},next:{title:"IfcPropertiesTiler",permalink:"/Tutorials/Components/Core/IfcPropertiesTiler"}},p={},m=[{value:"\ud83c\udfe0\ud83d\udc49\ud83e\udd16 From IFC to fragment in 1 minute",id:"-from-ifc-to-fragment-in-1-minute",level:3},{value:"\ud83d\udd2d\ud83d\udd27 Calibrating the converter",id:"-calibrating-the-converter",level:3},{value:"\ud83d\ude97\ud83d\udd25 Loading the IFC",id:"-loading-the-ifc",level:3},{value:"\ud83c\udf81 Exporting the result",id:"-exporting-the-result",level:3},{value:"\ud83e\udde0\ud83e\uddfc Cleaning memory",id:"-cleaning-memory",level:3}],u={toc:m},d="wrapper";function f(e){var t=e.components,n=(0,r.Z)(e,i);return(0,a.kt)(d,(0,o.Z)({},u,n,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("admonition",{title:"Source",type:"info"},(0,a.kt)("p",{parentName:"admonition"},"Copying and pasting? We've got you covered! You can find the full source code of this tutorial ",(0,a.kt)("a",{parentName:"p",href:"https://github.com/ThatOpen/engine_components/blob/main/packages/core/src/fragments/IfcLoader/example.ts"},"here"),".")),(0,a.kt)("h3",{id:"-from-ifc-to-fragment-in-1-minute"},"\ud83c\udfe0\ud83d\udc49\ud83e\udd16 From IFC to fragment in 1 minute"),(0,a.kt)("hr",null),(0,a.kt)("p",null,"Fragments are great: they are lightweight, they are fast and we\nhave tons of tools to work with them. But fragments are not used\noutside our libraries. So how can we convert an IFC file to fragments?\nEasy: with the ",(0,a.kt)("inlineCode",{parentName:"p"},"FragmentIfcLoader"),"! Let's start by creating it."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},'import * as WEBIFC from "web-ifc";\nimport * as BUI from "@thatopen/ui";\nimport Stats from "stats.js";\nimport * as OBC from "openbim-components";\n\nconst container = document.getElementById("container")!;\n\nconst components = new OBC.Components();\n\nconst worlds = components.get(OBC.Worlds);\n\nconst world = worlds.create<\n  OBC.SimpleScene,\n  OBC.SimpleCamera,\n  OBC.SimpleRenderer\n>();\n\nworld.scene = new OBC.SimpleScene(components);\nworld.renderer = new OBC.SimpleRenderer(components, container);\nworld.camera = new OBC.SimpleCamera(components);\n\ncomponents.init();\n\nworld.camera.controls.setLookAt(12, 6, 8, 0, 0, -10);\n\nworld.scene.setup();\n\nconst grids = components.get(OBC.Grids);\ngrids.create(world);\n')),(0,a.kt)("admonition",{title:"Why not just IFC?",type:"info"},(0,a.kt)("p",{parentName:"admonition"},"IFC is nice because it lets us exchange data with many tools in the\nAECO industry. But it also has some limitations. In a nutshell,\ndata coming from IFC needs to be processed and converted to triangles\nto be able to draw it in 3D, and that requires processing power\nand time! That's why we convert it to fragments to display it.\nOnce you have the fragments, you can store them and load them\ndirectly the next time your user tries to load that IFC: it will\nload 10 times faster!")),(0,a.kt)("h3",{id:"-calibrating-the-converter"},"\ud83d\udd2d\ud83d\udd27 Calibrating the converter"),(0,a.kt)("hr",null),(0,a.kt)("p",null,"Now, we need to configure the path of the WASM files. What's WASM?\nIt's a technology that lets us run C++ on the browser, which means\nthat we can load IFCs super fast! These files are the compilation of\nour ",(0,a.kt)("inlineCode",{parentName:"p"},"web-ifc")," library. You can find them in the github repo and in NPM.\nThese files need to be available to our app, so you have 2 options:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Download them and serve them statically."),(0,a.kt)("li",{parentName:"ul"},"Get them from a remote server.\nThe easiest way is getting them from unpkg, and the cool thing is that\nyou don't need to do it manually! It can be done directly by the tool\njust by writing the following:")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"const fragments = components.get(OBC.FragmentsManager);\nconst fragmentIfcLoader = components.get(OBC.IfcLoader);\n")),(0,a.kt)("p",null,"Awesome! Optionally, we can exclude categories that we don't want\nto convert to fragments like very easily:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},'await fragmentIfcLoader.setup();\n\n/* If you want to the path to unpkg manually, then you can skip the line\n  above and set them manually as below:\n  fragmentIfcLoader.settings.wasm = {\n      path: "https://unpkg.com/web-ifc@0.0.53/",\n      absolute: true\n  }\n')),(0,a.kt)("p",null,"We can further configure the conversion using the ",(0,a.kt)("inlineCode",{parentName:"p"},"webIfc")," object.\nIn this example, we will make the IFC model go to the origin of\nthe scene (don't worry, this supports model federation) and\noptimize the profiles geometry so that it generates very\nefficient geometry for certain geometries (e.g. HVAC):"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"const excludedCats = [\n  WEBIFC.IFCTENDONANCHOR,\n  WEBIFC.IFCREINFORCINGBAR,\n  WEBIFC.IFCREINFORCINGELEMENT,\n];\n\nfor (const cat of excludedCats) {\n  fragmentIfcLoader.settings.excludedCategories.add(cat);\n}\n")),(0,a.kt)("h3",{id:"-loading-the-ifc"},"\ud83d\ude97\ud83d\udd25 Loading the IFC"),(0,a.kt)("hr",null),(0,a.kt)("p",null,"Next, let's define a function to load the IFC programmatically.\nWe have hardcoded the path to one of our IFC files, but feel free\nto do this with any of your own files!"),(0,a.kt)("admonition",{title:"Opening local IFCs",type:"info"},(0,a.kt)("p",{parentName:"admonition"},"Keep in mind that the browser can't access the file of your\ncomputer directly, so you will need to use the Open File API to\nopen local files.")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"fragmentIfcLoader.settings.webIfc.COORDINATE_TO_ORIGIN = true;\nfragmentIfcLoader.settings.webIfc.OPTIMIZE_PROFILES = true;\n")),(0,a.kt)("h3",{id:"-exporting-the-result"},"\ud83c\udf81 Exporting the result"),(0,a.kt)("hr",null),(0,a.kt)("p",null,"Once you have your precious fragments, you might want to save them\nso that you don't need to open this IFC file each time your user\ngets into your app. Instead, the next time you can load the\nfragments directly. Defining a function to export fragments\nis as easy as this:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},'// const cullers = components.get(OBC.Cullers);\n// const culler = cullers.create(world);\n// culler.enabled = true;\n\nasync function loadIfc() {\n  const file = await fetch("https://thatopen.github.io/engine_components/resources/small.ifc");\n  const data = await file.arrayBuffer();\n  const buffer = new Uint8Array(data);\n  const model = await fragmentIfcLoader.load(buffer);\n  model.name = "example";\n  world.scene.three.add(model);\n  // for (const mesh of model.children) {\n  //   culler.add(mesh as any);\n  // }\n}\n\n// world.camera.controls.addEventListener("sleep", () => {\n//   culler.needsUpdate = true\n// })\n')),(0,a.kt)("h3",{id:"-cleaning-memory"},"\ud83e\udde0\ud83e\uddfc Cleaning memory"),(0,a.kt)("hr",null),(0,a.kt)("p",null,"Now, just like in the ",(0,a.kt)("inlineCode",{parentName:"p"},"FragmentManager")," tutorial, you will need\nto dispose the memory if your user wants to reset the state of the\nscene, especially if you are using Single Page Application\ntechnologies like React, Angular, Vue, etc. To do that, you\ncan simply call the ",(0,a.kt)("inlineCode",{parentName:"p"},"dispose")," method:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},'function download(file: File) {\n  const link = document.createElement("a");\n  link.href = URL.createObjectURL(file);\n  link.download = file.name;\n  document.body.appendChild(link);\n  link.click();\n  link.remove();\n}\n\nasync function exportFragments() {\n  if (!fragments.groups.size) {\n    return;\n  }\n  const group = Array.from(fragments.groups.values())[0];\n  const data = fragments.export(group);\n  download(new File([new Blob([data])], "small.frag"));\n\n  const properties = group.getLocalProperties();\n  if (properties) {\n    download(new File([JSON.stringify(properties)], "small.json"));\n  }\n}\n')),(0,a.kt)("p",null,"That's it! Congrats, now you can load IFC files into your app,\ngenerate the 3D geometry and property data for them and navigate\nthem in 3D. In other tutorials, you'll find tons of tools to\nwork with them and create amazing BIM apps! See you there \ud83d\udcaa"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"function disposeFragments() {\n  fragments.dispose();\n}\n")),(0,a.kt)("iframe",{src:"https://thatopen.github.io/engine_components/examples/IfcLoader"}))}f.isMDXComponent=!0}}]);